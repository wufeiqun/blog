## 背景介绍

使用云计算多的话, 很多技术都没有亲自尝试, 也没有深入理解背后的原理, 还是要学习每一个技术背后的原理, 理解原理并写一个自己理解的文章.

对于磁盘也是一样, 这里记录一下Linux如何新加一个磁盘的过程, 这些技术可能已经过时, 但是写文章可以让自己的思维更加清晰, 即使以后用不到了, 也可以锻炼自己的思维.



## 加磁盘过程



#### 挂载新磁盘

一般在VMware或者PVE控制台操作.

#### 确认新磁盘

使用如下命令确认新磁盘是否已经挂载成功:

```
lsblk -f
或者
fdisk -l

# 示例
[root@server134 ~]# lsblk -f
NAME        FSTYPE FSVER LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINTS
sr0
nvme0n1
├─nvme0n1p1 vfat   FAT32       B586-B91F                             503.7M     1% /boot/efi
├─nvme0n1p2 ext4   1.0         b92206f8-777d-44ed-b073-c2f58d0eb63a    288M    34% /boot
└─nvme0n1p3 xfs                fc4a475c-8524-438f-a41c-bd6d9137953a   17.5G     8% /
nvme0n2
[root@server134 ~]# fdisk -l
Disk /dev/nvme0n1: 20 GiB, 21474836480 bytes, 41943040 sectors
Disk model: VMware Virtual NVMe Disk
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: 31AB6417-AFB9-472B-AFCD-720ED9E066DB

Device           Start      End  Sectors  Size Type
/dev/nvme0n1p1    2048  1050623  1048576  512M EFI System
/dev/nvme0n1p2 1050624  2099199  1048576  512M Linux filesystem
/dev/nvme0n1p3 2099200 41940991 39841792   19G Linux filesystem


Disk /dev/nvme0n2: 10 GiB, 10737418240 bytes, 20971520 sectors
Disk model: VMware Virtual NVMe Disk
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
```



从上面可以看到`/dev/nvme0n2`是新磁盘, 传统的新磁盘一般是`/dev/sdc`或者`/dev/hdb`这样的格式.



#### ~~磁盘分区(可选)~~

分区就是将`sda`改成`sda1/sda2/sda3`等, 把一个磁盘

`磁盘分区`只是为了让操作系统知道：

- 这块盘被切成几段
- 各段分别存储什么文件系统

但如果整块磁盘只用来挂载一个文件系统，只是单一作用的话那么分区表不是必须的。我自己一般也不分区, 一个系统盘, 一个数据盘.



#### 格式化磁盘

```
# xfs格式
mkfs.xfs -f /dev/sdc

# ext4格式
mkfs.ext4 -F /dev/nvme0n2
```



#### 临时挂载

```
# 创建目录
mkdir /data

# 挂载
mount -t xfs /dev/sdc /data
mount -t ext4 /dev/nvme0n2 /data

# 验证
[root@server134 ~]# df -hT
Filesystem     Type      Size  Used Avail Use% Mounted on
devtmpfs       devtmpfs  4.0M     0  4.0M   0% /dev
tmpfs          tmpfs     851M     0  851M   0% /dev/shm
tmpfs          tmpfs     341M  5.0M  336M   2% /run
efivarfs       efivarfs  256K   32K  225K  13% /sys/firmware/efi/efivars
/dev/nvme0n1p3 xfs        19G  1.5G   18G   8% /
/dev/nvme0n1p2 ext4      488M  164M  289M  37% /boot
/dev/nvme0n1p1 vfat      511M  7.3M  504M   2% /boot/efi
tmpfs          tmpfs     171M     0  171M   0% /run/user/0
/dev/nvme0n2   ext4      9.8G   24K  9.3G   1% /data
```



#### 永久挂载

建议使用UUID, 避免设备名称变动:

```
# 获取磁盘UUID
[root@server134 ~]# blkid /dev/nvme0n2
/dev/nvme0n2: UUID="98bf4d50-1e6f-4510-9fc9-bb56810158cd" TYPE="ext4"

# 写入/etc/fstab
UUID=98bf4d50-1e6f-4510-9fc9-bb56810158cd  /data  xfs   defaults  0 0
或者
UUID=98bf4d50-1e6f-4510-9fc9-bb56810158cd  /data  ext4   defaults  0 0

# 验证fstab文件配置是否正确, 执行如下命令, 没有报错就表示配置正常, 不需要重启服务器
mount -a

```









