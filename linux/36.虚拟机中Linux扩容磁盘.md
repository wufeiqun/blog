## 背景介绍

最近在学习LVM技术, 正好工作中也有很多地方不是LVM的磁盘, 都是关于磁盘扩容的. 我突然意识到我们使用Linux的场景大部分都是虚拟机不管是通过公有云创建的还是通过VMware还是PVE, 这些Linux系统都是通过虚拟化而来的, 这时候LVM我觉得必要性就没那么大了, 因为磁盘都是可以在线扩容的, 服务器一般也不需要重启就能生效.



我自己一般使用磁盘的习惯是, 一个磁盘只划分一个分区, 比如`/dev/sda`这个磁盘我一般就使用`sda1`这一个分区, 一般是系统盘; 如果有数据盘, 新加一个磁盘`/dev/sdb`即可.



## 分区编号

磁盘扩容中经常需要关注磁盘分区以及分区具体编号, 这里根据自己的理解简单总结一下:

* 传统的硬盘在Linux中一般命名方式为`sda/sdb/hda/hdb`等等, 其中a, b代表不同的硬盘; `sda1`中1代表分区编号
* 比较新的是NVME协议的硬盘, 命名一般为`nvme0n1/nvme1n1`, 其中前面的0,1分别代表不同的硬盘, 后面的n1是命名空间, 只不过一般默认都是用一个命名空间;`nvme0n1p1`其中最后的p1表示的分区, 加了一个字母p的目的是跟前面的命名空间区分开, 实际执行磁盘相关命名的时候只需要最后的那个数字, 下面会举例子. 

## 磁盘扩容



* 安装相关的工具

```
# CentOS系列
yum install -y cloud-utils-growpart
# Ubuntu系列
apt-get install -y cloud-guest-utils
```



* 扩容磁盘

  这里一般是通过虚拟机来实现, 比如VMware/PVE等. 

  

* 扩大分区到整个磁盘

```
# 普通硬盘, 注意磁盘和后面的分区是有空格的
growpart /dev/sda 3
# nvme协议的硬盘, 不用加后面那个字母p
growpart /dev/nvme0n1 3
```



**这里要注意被扩容的分区一定要是该磁盘的最后, 如果在磁盘的中间的话就不能这么搞了, 简单起见一个磁盘就搞一个分区即可.**

* 扩容文件系统

**根据实战经验, 如果磁盘直接全盘使用没有分区的话, 也就是没有磁盘分区那些数字的话, 磁盘扩容不用执行growpart, 直接使用resize2fs命令, 并且参数中也不用带分区数字**

```
# ext4类型的文件系统, resize2fs /dev/<目标设备名称>, 注意这里要带上分区数字, 并且没有空格
resize2fs /dev/sda1

# xfs文件系统, xfs_growfs <挂载目录>, 注意这里的参数不是设备而是挂载目录
xfs_growfs /data
```

* 验证

```
df -hT
```



## 参考

https://www.alibabacloud.com/help/zh/ecs/user-guide/resize-linux-cloud-disks
